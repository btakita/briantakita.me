---
import type { Post, SearchItem } from '@btakita/domain--all--blog'
import { sorted__posts__new } from '@btakita/domain--server--blog'
import { V_main_search } from '@btakita/ui--server--blog'
import { getCollection } from 'astro:content'
import Footer from '../../components/Footer.astro'
import Header from '../../components/Header.astro'
import Rel from '../../components/Rel.astro'
import { SITE } from '../../config'
import Layout from '../../layouts/Layout.astro'
import { server__ctx__new } from '../../lib'
const ctx = server__ctx__new(Astro)
const posts = sorted__posts__new(await getCollection('posts') as Post[])
// List of items to search in
const search_item_a = posts.map(post=>({
	title: post.data.title,
	description: post.data.description,
	slug: post.slug,
	data: post.data,
} as SearchItem))
---

<Layout title={`Search | ${SITE.title}`}>
	<Header ctx={ctx} active="search"/>
	<Rel dom={
		V_main_search({ ctx, search_item_a })
	}></Rel>
	<Footer ctx={ctx}/>
</Layout>

<script>
	import { browser__ctx__ensure } from '@btakita/domain--browser--briantakita'
	import { Main_search__onbind } from '@btakita/ui--all--blog'
	import { dom__onbind__register } from '@ctx-core/dom'
	const ctx = browser__ctx__ensure()
	dom__onbind__register(ctx, Main_search__onbind)
</script>
